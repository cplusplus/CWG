<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 694</TITLE>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  @media (prefers-color-scheme: dark) {
    HTML { background-color:#202020; color:#f0f0f0; }
    A { color:#5bc0ff; }
    A:visited { color:#c6a8ff; }
    A:hover, a:focus { color:#afd7ff; }
    INS { background-color:#033a16; color:#aff5b4; }
    .INS { background-color: #033a16; }
    DEL { background-color:#67060c; color:#ffdcd7; }
    .DEL { background-color:#67060c; }
  }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116c.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2025-03-08</P>
<HR>
<A NAME="694"></A><H4>694.
  
Zero- and value-initialization of union objects
</H4>
<B>Section: </B>9.4&#160; [<A href="https://wg21.link/dcl.init">dcl.init</A>]
 &#160;&#160;&#160;

 <B>Status: </B>C++11
 &#160;&#160;&#160;

 <B>Submitter: </B>Clark Nelson
 &#160;&#160;&#160;

 <B>Date: </B>14 May, 2008
  &#160;&#160;&#160;
  <B>Liaison: </B>WG14<BR>


<P>[Voted into the WP at the November, 2010 meeting.]</P>

<P>The C committee is considering changing the definition of
zero-initialization of unions to guarantee that the bytes of the
entire union are set to zero before assigning 0, converted to the
appropriate type, to the first member.  The argument (summarized
<A href="http://www.open-std.org/jtc1/sc22/wg14/11416">here</A>)
is for backward compatibility.  The C++ Committee may want to
consider the same change.</P>

<P><B>Proposed resolution (August, 2008):</B></P>

<P>Change bullet 3 of 9.4 [<A href="https://wg21.link/dcl.init#5">dcl.init</A>] paragraph 5 (in the first
list, dealing with zero-initialization) as follows:</P>

<UL><LI>if <TT>T</TT> is a (possibly cv-qualified) union type,
<INS>the object representation of <TT>T</TT> (6.8 [<A href="https://wg21.link/basic.types">basic.types</A>]) is zero-initialized, after which</INS> the object's first
non-static named data member is zero-initialized;</LI></UL>

<P><I>[Drafting notes: Ask a C liaison about the progress of WG14
paper N1311, which deals with this issue.  Since the adoption of
WG21 paper N2544, unions may have static data members, hence the
change to refer to the first non-static data member and the
deletion of the footnote.]</I></P>

<P><B>Notes from the September, 2008 meeting:</B></P>

<P>It was observed that padding bytes in structs are
zero-initialized in C, so if we are changing the treatment of
unions in this way we should consider adding the C behavior for
padding bytes at the same time.  In particular, using
<TT>memcmp</TT> to compare structs only works reliably if the
padding bytes are zero-initialized.</P>

<P><B>Additional notes (February, 2010):</B></P>

<P>The C Committee has changed its approach to this question and
is no longer using a two-phase process; in C, zero-initialization
is specific to program start-up and thus is not appropriate for
use with thread-local storage. See C paper
<A href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1387.htm">N1387</A>.</P>

<P><B>Proposed resolution (October, 2010):</B></P>

<P>Change 9.4 [<A href="https://wg21.link/dcl.init#5">dcl.init</A>] paragraph 5 as follows:</P>

<BLOCKQUOTE>

<P>To <I>zero-initialize</I> an object or reference of type <TT>T</TT>
means:</P>

<UL>
<LI><P>if <TT>T</TT> is a scalar type (6.8 [<A href="https://wg21.link/basic.types">basic.types</A>]),
the object is set to the value <TT>0</TT> (zero), taken as an integral
constant expression, converted to <TT>T</TT>;<SUP>103</SUP>
</P></LI>

<LI><P>if T is a (possibly cv-qualified) non-union class type, each
non-static data member and each base-class subobject is
zero-initialized<INS>, and padding is initialized to zero bits</INS>;</P></LI>

<LI><P>if T is a (possibly cv-qualified) union type, the object's
first non-static named data member is zero-initialized<INS>, and padding
is initialized to zero bits</INS>;</P></LI>

<LI><P>if T is an array type, each element is zero-initialized;</P></LI>

<LI><P>if T is a reference type, no initialization is performed.</P></LI>

</UL>

</BLOCKQUOTE>

<BR><BR>
</BODY>
</HTML>
