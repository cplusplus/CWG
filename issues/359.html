<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 359</TITLE>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  @media (prefers-color-scheme: dark) {
    HTML { background-color:#202020; color:#f0f0f0; }
    A { color:#5bc0ff; }
    A:visited { color:#c6a8ff; }
    A:hover, a:focus { color:#afd7ff; }
    INS { background-color:#033a16; color:#aff5b4; }
    .INS { background-color: #033a16; }
    DEL { background-color:#67060c; color:#ffdcd7; }
    .DEL { background-color:#67060c; }
  }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116c.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2025-03-08</P>
<HR>
<A NAME="359"></A><H4>359.
  
Type definition in anonymous union
</H4>
<B>Section: </B>11.5&#160; [<A href="https://wg21.link/class.union">class.union</A>]
 &#160;&#160;&#160;

 <B>Status: </B>NAD
 &#160;&#160;&#160;

 <B>Submitter: </B>Al Grant
 &#160;&#160;&#160;

 <B>Date: </B>31 May 2002<BR>


<P>Is this legal?  Should it be?</P>
<PRE>
  struct E {
    union {
      struct { int x; } s;
    } v;
  };
</PRE>
<P>One compiler faults a type definition (i.e. of the anonymous
struct) since it is in an anonymous union [11.5 [<A href="https://wg21.link/class.union#2">class.union</A>] paragraph 2:

"The <I>member-specification</I> of an anonymous union shall only define
non-static data members."].</P>

<P>I would suggest that compiler B is correctly interpreting the
standard but that this is a defect in the standard.  There is
no reason to disallow definition of anonymous structs.</P>

<P>Furthermore, is it really necessary to disallow definition of
named types in anonymous unions in general, as long as the
types do not need fully qualified names for external linkage?
Why should this be illegal?</P>
<PRE>
  struct E {
    union {
      typedef int Int;
      struct X { X *next; Int n; } list;
    } v;
  };
</PRE>

<P><B>Notes from October 2002 meeting:</B></P>

<P>There was agreement that the standard says such declarations
are invalid; therefore this must be considered as an extension.
There was general feeling that this extension would not
be too useful, though
Jason Merrill was sympathetic to the argument.  It was also
agreed that if this were to be changed it would require careful
wording so as not to allow too many cases.</P>

<P><B>Note (March, 2008):</B></P>

<P>The Evolution Working Group recommended closing this issue with no
further consideration.  See paper J16/07-0033 = WG21 N2173.</P>

<BR><BR>
</BODY>
</HTML>
