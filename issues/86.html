<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 86</TITLE>
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116b.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2025-03-05</P>
<HR>
<A NAME="86"></A><H4>86.
  
Lifetime of temporaries in query expressions
</H4>
<B>Section: </B>6.7.7&#160; [<A href="https://wg21.link/class.temporary">class.temporary</A>]
 &#160;&#160;&#160;

 <B>Status: </B>CD1
 &#160;&#160;&#160;

 <B>Submitter: </B>Steve Adamczyk
 &#160;&#160;&#160;

 <B>Date: </B>Jan 1999<BR>



<P>[Voted into WP at April, 2006 meeting.]</P>

<P>In
6.7.7 [<A href="https://wg21.link/class.temporary">class.temporary</A>]

paragraph 5,
should binding a reference to the result of a "<TT>?</TT>" operation, each
of whose branches is a temporary, extend both temporaries?</P>

<P>Here's an example:</P>
<PRE>
    const SFileName &amp;C = noDir ? SFileName("abc") : SFileName("bcd");
</PRE>
<P>Do the temporaries created by the <TT>SFileName</TT> conversions survive
the end of the full expression?</P>

<P><B>Notes from 10/00 meeting:</B></P>

<P>Other problematic examples include cases where the temporary
from one branch is a base class of the temporary from the other (i.e.,
where the implementation must remember which type of temporary must
be destroyed), or where one branch is a temporary and the other is
not.  Similar questions also apply to the comma operator.  The sense
of the core language working group was that implementations should
be required to support these kinds of code.</P>

<P><B>Notes from the March 2004 meeting:</B></P>

<P>We decided that the cleanest model is one in which any "?" operation
that returns a class rvalue always copies one of its operands to
a temporary and returns the temporary as the result of the operation.
(Note that this may involve slicing.)  An implementation would be
free to optimize this using the rules in 11.4.5.3 [<A href="https://wg21.link/class.copy.ctor#15">class.copy.ctor</A>] paragraph 15,
 and in fact we would expect that in many cases
compilers would do such optimizations.  For example, the compiler
could construct both rvalues in the above example into a
single temporary, and thus avoid a copy.</P>

<P>See also <A HREF="446.html">issue 446</A>.</P>

<P><B>Proposed resolution (October, 2004):</B></P>

<P>This issue is resolved by the resolutions of <A HREF="446.html">issue 446</A>.</P>

<P><B>Note (October, 2005):</B></P>

<P>This issue was overlooked when <A HREF="446.html">issue 446</A>
was moved to &#8220;ready&#8221; status and was thus inadvertently
omitted from the list of issues accepted as Defect Reports at the
October, 2005 meeting.</P>

<BR><BR>
</BODY>
</HTML>
