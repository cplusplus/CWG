<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 1436</TITLE>
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116b.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2025-03-05</P>
<HR>
<A NAME="1436"></A><H4>1436.
  
Interaction of constant expression changes with preprocessor expressions
</H4>
<B>Section: </B>15.2&#160; [<A href="https://wg21.link/cpp.cond">cpp.cond</A>]
 &#160;&#160;&#160;

 <B>Status: </B>open
 &#160;&#160;&#160;

 <B>Submitter: </B>Richard Smith
 &#160;&#160;&#160;

 <B>Date: </B>2012-01-02<BR>




<P>It appears that some of the recent changes to the description of
constant expressions have allowed constructs into preprocessor
expressions that do not belong there.  Some changes are required to
restrict the current capabilities of constant expressions to what
is intended to be allowed in preprocessor expressions.</P>

<P><B>Proposed resolution (February, 2012):</B></P>

<OL>
<LI><P>Change 15.2 [<A href="https://wg21.link/cpp.cond#8">cpp.cond</A>] paragraph 8 as follows:</P></LI>

<BLOCKQUOTE>

Each preprocessing token that remains (in the list of preprocessing
tokens that will become the controlling expression) after all macro
replacements have occurred shall be in the lexical form of a token
(5.10 [<A href="https://wg21.link/lex.token">lex.token</A>]). <INS>Any such token that is a literal
(5.13.1 [<A href="https://wg21.link/lex.literal.kinds">lex.literal.kinds</A>]) shall be an <I>integer-literal</I>, a
<I>character-literal</I>, or a <I>boolean-literal</I>.</INS>

</BLOCKQUOTE>

<LI><P>Change 15.2 [<A href="https://wg21.link/cpp.cond#12">cpp.cond</A>] paragraph 12 as follows:</P></LI>

<BLOCKQUOTE>

...using arithmetic that has at least the ranges specified in
17.3 [<A href="https://wg21.link/support.limits">support.limits</A>]. <INS>The only operators permitted in the
controlling constant expression are <TT>?:</TT>, <TT>||</TT>,
<TT>&amp;&amp;</TT>, <TT>|</TT>, <TT>^</TT>, <TT>&amp;</TT>,
<TT>==</TT>, <TT>!=</TT>, <TT>&lt;</TT>, <TT>&lt;=</TT>,
<TT>&gt;</TT>, <TT>&gt;=</TT>, <TT>&lt;&lt;</TT>, <TT>&gt;&gt;</TT>,
<TT>-</TT>, <TT>+</TT>, <TT>*</TT>, <TT>/</TT>, <TT>%</TT>,
<TT>!</TT>, and <TT>~</TT>.</INS> For the purposes of this token
conversion...

</BLOCKQUOTE>

</OL>

<P><B>Additional note (March, 2022):</B></P>

<P>The proposed resolution shown above allows
<I>lambda-expression</I>s, which is undesirable.</P>

<P><B>CWG 2022-11-11</B></P>

<P>A possible approach, in addition to the proposed resolution above,
is to prohibit the <TT>[</TT> and <TT>{</TT> <I>pp-token</I>s in the
controlling expression of a conditional inclusion. C++ also permits
using the alternative tokens, e.g. <TT>not</TT>, which might need
clarification in the wording.</P>

<BR><BR>
</BODY>
</HTML>
