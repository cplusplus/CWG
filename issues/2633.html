<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 2633</TITLE>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  @media (prefers-color-scheme: dark) {
    HTML { background-color:#202020; color:#f0f0f0; }
    A { color:#5bc0ff; }
    A:visited { color:#c6a8ff; }
    A:hover, a:focus { color:#afd7ff; }
    INS { background-color:#033a16; color:#aff5b4; }
    .INS { background-color: #033a16; }
    DEL { background-color:#67060c; color:#ffdcd7; }
    .DEL { background-color:#67060c; }
  }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116c.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2025-03-08</P>
<HR>
<A NAME="2633"></A><H4>2633.
  
typeid of constexpr-unknown dynamic type
</H4>
<B>Section: </B>7.7&#160; [<A href="https://wg21.link/expr.const">expr.const</A>]
 &#160;&#160;&#160;

 <B>Status: </B>open
 &#160;&#160;&#160;

 <B>Submitter: </B>Jim X
 &#160;&#160;&#160;

 <B>Date: </B>2022-09-18<BR>


<P>Consider the example in 7.7 [<A href="https://wg21.link/expr.const#7">expr.const</A>] paragraph 7:</P>

<PRE>
extern Swim dc;
constexpr auto&amp; sandeno  = typeid(dc);     //<SPAN CLASS="cmnt"> OK, can only be typeid(Swim)</SPAN>
</PRE>

<P>The comment in the example seems not to be backed by normative
text.  In particular, the dynamic type of <TT>dc</TT> is
constexpr-unknown per 7.7 [<A href="https://wg21.link/expr.const#7">expr.const</A>] paragraph 7:</P>

<BLOCKQUOTE>

During the evaluation of an expression E as a core constant
expression, all <I>id-expression</I>s and uses of <TT>*this</TT> that
refer to an object or reference whose lifetime did not begin with the
evaluation of E are treated as referring to a specific instance of
that object or reference whose lifetime and that of all subobjects
(including all union members) includes the entire constant
evaluation. For such an object that is not usable in constant
expressions, the dynamic type of the object is constexpr-unknown. ...

</BLOCKQUOTE>

<P>Thus, <TT>typeid(dc)</TT> is not a core constant expression per
7.7 [<A href="https://wg21.link/expr.const#5.26">expr.const</A>] bullet 5.26:</P>

<BLOCKQUOTE>

<UL>
<LI>
a dynamic_cast (7.6.1.7 [<A href="https://wg21.link/expr.dynamic.cast">expr.dynamic.cast</A>]) or typeid
(7.6.1.8 [<A href="https://wg21.link/expr.typeid">expr.typeid</A>]) expression on a glvalue that refers to
an object whose dynamic type is constexpr-unknown or that would throw
an exception;
</LI>
</UL>

</BLOCKQUOTE>

<BR><BR>
</BODY>
</HTML>
