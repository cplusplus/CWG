<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 2496</TITLE>
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2024-12-19</P>
<HR>
<A NAME="2496"></A><H4>2496.
  
<I>ref-qualifier</I>s and virtual overriding
</H4>
<B>Section: </B>11.7.3&#160; [<A href="https://wg21.link/class.virtual">class.virtual</A>]
 &#160;&#160;&#160;

 <B>Status: </B>CD6
 &#160;&#160;&#160;

 <B>Submitter: </B>Jens Maurer
 &#160;&#160;&#160;

 <B>Date: </B>2021-06-16<BR>


<P>[Accepted as a DR at the October, 2021 meeting.]</P>



<P>According to 11.7.3 [<A href="https://wg21.link/class.virtual#2">class.virtual</A>] paragraph 2,</P>

<BLOCKQUOTE>

If a virtual member function <I>F</I> is declared in a class
<I>B</I>, and, in a class <I>D</I> derived (directly or
indirectly) from <I>B</I>, a declaration of a member
function <I>G</I> corresponds (6.4.1 [<A href="https://wg21.link/basic.scope.scope">basic.scope.scope</A>])
to a declaration of <I>F</I>, ignoring
trailing <I>requires-clause</I>s, then <I>G</I>
overrides<SUP>105</SUP> <I>F</I>.

</BLOCKQUOTE>

<P>This is different from C++20, where <I>G</I> was
considered to hide, rather than to override, <I>F</I> if
the <I>ref-qualifier</I>s of the declarations are
different. This unintentional change could be addressed
in one of two ways. To restore the C++20 behavior, the
cited paragraph could be amended to:</P>

<BLOCKQUOTE>

...a declaration of a member
function <I>G</I> corresponds (6.4.1 [<A href="https://wg21.link/basic.scope.scope">basic.scope.scope</A>])
to a declaration of <I>F</I>, ignoring
trailing <I>requires-clause</I>s, <INS>and has the same
<I>ref-qualifier</I> (if any),</INS> then <I>G</I>
overrides<SUP>105</SUP> <I>F</I>.

</BLOCKQUOTE>

<P>Alternatively, such a situation could be regarded as an
ill-formed attempt to override the base class function,
which could be specified by adding the following as a new
paragraph preceding 11.7.3 [<A href="https://wg21.link/class.virtual">class.virtual</A>] paragraph
7:</P>

<BLOCKQUOTE>

<P><INS>The <I>ref-qualifier</I>, or lack thereof, of an
overriding function shall be the same as that of the
overridden function.</INS></P>

<P>The return type of an overriding function shall be either
identical to the return type of the overridden function or
<I>covariant</I>...</P>

</BLOCKQUOTE>

<P><B>Notes from the August, 2021 teleconference:</B></P>

<P>CWG preferred the second option.</P>

<P><B>Proposed resolution, August, 2021:</B></P>

<P>Add the following as a new paragraph preceding
11.7.3 [<A href="https://wg21.link/class.virtual#7">class.virtual</A>] paragraph 7:</P>

<BLOCKQUOTE>

<P><INS>The <I>ref-qualifier</I>, or lack thereof, of an
overriding function shall be the same as that of the
overridden function.</INS></P>

<P>The return type of an overriding function shall be either
identical to the return type of the overridden function or
<I>covariant</I>...</P>

</BLOCKQUOTE>

<BR><BR>
</BODY>
</HTML>
