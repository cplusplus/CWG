<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 1915</TITLE>
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116b.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2025-03-05</P>
<HR>
<A NAME="1915"></A><H4>1915.
  
Potentially-invoked destructors in non-throwing constructors
</H4>
<B>Section: </B>11.9.3&#160; [<A href="https://wg21.link/class.base.init">class.base.init</A>]
 &#160;&#160;&#160;

 <B>Status: </B>open
 &#160;&#160;&#160;

 <B>Submitter: </B>Aaron Ballman
 &#160;&#160;&#160;

 <B>Date: </B>2014-04-15
  &#160;&#160;&#160;
  <B>Liaison: </B>EWG<BR>


<P>The requirement in 11.9.3 [<A href="https://wg21.link/class.base.init#10">class.base.init</A>] paragraph 10,</P>

<BLOCKQUOTE>

In a non-delegating constructor, the destructor for each potentially
constructed subobject of class type is potentially invoked
(11.4.7 [<A href="https://wg21.link/class.dtor">class.dtor</A>]). [<I>Note:</I> This provision ensures that
destructors can be called for fully-constructed sub-objects in case an
exception is thrown (14.3 [<A href="https://wg21.link/except.ctor">except.ctor</A>]). &#8212;<I>end note</I>]

</BLOCKQUOTE>

<P>is needlessly restrictive, preventing otherwise-reasonable code like</P>

<PRE>
  class Base {
  protected:
    Base(int i) noexcept {}
    Base() = delete;
    ~Base() = delete;
  };

  class Derived : public Base {
  public:
    Derived() noexcept : Base(1) {}
    ~Derived() = delete;
  };
</PRE>

<P>Since the derived class constructor is non-throwing, the deleted
base class destructor need not be referenced.</P>

<P><U>Suggested resolution:</U></P>

<P>Change 11.9.3 [<A href="https://wg21.link/class.base.init#10">class.base.init</A>] paragraph 10 as follows:</P>

<BLOCKQUOTE>

In a non-delegating constructor <INS>without a
non-throwing <I>exception-specification</I>
(14.5 [<A href="https://wg21.link/except.spec">except.spec</A>])</INS>, the destructor for each potentially
constructed subobject of class type is potentially invoked
(11.4.7 [<A href="https://wg21.link/class.dtor">class.dtor</A>]). [<I>Note:</I> This provision ensures that
destructors can be called for fully-constructed sub-objects in case an
exception is thrown (14.3 [<A href="https://wg21.link/except.ctor">except.ctor</A>]) <INS>but does not
prevent explicitly deleted destructors in the presence of a non-throwing
constructor</INS>. &#8212;<I>end note</I>]

</BLOCKQUOTE>

<P><B>Rationale (June, 2014):</B></P>

<P>This request for a language change should be evaluated by EWG
before any action is taken.</P>

<P><B>EWG 2022-11-11</B></P>

<P>This is a defect, but has ABI impact that should be explored in a
paper to EWG.
This is tracked in github issue
<A HREF="https://github.com/cplusplus/papers/issues/1371">cplusplus/papers#1371</A>.</P>

<BR><BR>
</BODY>
</HTML>
