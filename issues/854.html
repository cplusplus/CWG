<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 854</TITLE>
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  .DEL { text-decoration:line-through; background-color: #FFD0D0 }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 116a.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2024-12-19</P>
<HR>
<A NAME="854"></A><H4>854.
  
Left shift and unsigned extended types
</H4>
<B>Section: </B>7.6.7&#160; [<A href="https://wg21.link/expr.shift">expr.shift</A>]
 &#160;&#160;&#160;

 <B>Status: </B>CD2
 &#160;&#160;&#160;

 <B>Submitter: </B>Daniel Kr&#252;gler
 &#160;&#160;&#160;

 <B>Date: </B>5 April, 2009<BR>


<P>[Voted into WP at October, 2009 meeting.]</P>



<P>According to 7.6.7 [<A href="https://wg21.link/expr.shift#2">expr.shift</A>] paragraph 2,</P>

<BLOCKQUOTE>

The value of <TT>E1 &lt;&lt; E2</TT> is <TT>E1</TT> (interpreted as a
bit pattern) left-shifted <TT>E2</TT> bit positions; vacated bits are
zero-filled.  If <TT>E1</TT> has an unsigned type, the value of the
result is <TT>E1</TT> multiplied by the quantity 2 raised to the power
<TT>E2</TT>, reduced modulo <TT>ULLONG_MAX+1</TT> if <TT>E1</TT> has
type <TT>unsigned long long int</TT>, <TT>ULONG_MAX+1</TT> if
<TT>E1</TT> has type <TT>unsigned long int</TT>, <TT>UINT_MAX+1</TT>
otherwise.

</BLOCKQUOTE>

<P>This specification does not allow for extended types with rank
greater than <TT>long long</TT>; in particular, it says that the
value of a shifted unsigned extended type is truncated as if it were
the same width as an <TT>unsigned int</TT>.</P>

<P>It's unclear that the second sentence has any normative value; it
might be better to relegate it to a note or omit it than to correct
it.</P>

<P><B>Proposed resolution (July, 2009):</B></P>

<P>Change 7.6.7 [<A href="https://wg21.link/expr.shift">expr.shift</A>] paragraphs 2-3 as follows:</P>

<BLOCKQUOTE>

<P>The value of <TT>E1 &lt;&lt; E2</TT> is <TT>E1</TT>
<DEL>(interpreted as a bit pattern)</DEL> left-shifted <TT>E2</TT> bit
positions; vacated bits are zero-filled.  If <TT>E1</TT> has an
unsigned type, the value of the result is <TT>E1</TT> <DEL>multiplied
by the quantity 2 raised to the power <TT>E2</TT></DEL> <INS>&#215;
2<SUP><TT>E2</TT></SUP></INS>, reduced modulo
<DEL><TT>ULLONG_MAX+1</TT> if <TT>E1</TT> has type <TT>unsigned long
long int</TT>, <TT>ULONG_MAX+1</TT> if <TT>E1</TT> has type
<TT>unsigned long int</TT>, <TT>UINT_MAX+1</TT> otherwise.
[<I>Note:</I> the constants <TT>ULLONG_MAX</TT>, <TT>ULONG_MAX</TT>,
and <TT>UINT_MAX</TT> are defined in the header
<TT>&lt;climits&gt;</TT>. &#8212;<I>end note</I>]</DEL> <INS>one more
than the maximum value representable in the result type.  Otherwise,
if <TT>E1</TT> has a signed type and nonnegative value, and
<TT>E1</TT> &#215; 2<SUP><TT>E2</TT></SUP> is representable in the
result type, then that is the resulting value; otherwise, the behavior
is undefined.</INS>
</P>

<P>The value of <TT>E1 &gt;&gt; E2</TT> is <TT>E1</TT> right-shifted
<TT>E2</TT> bit positions. If <TT>E1</TT> has an unsigned type or if
<TT>E1</TT> has a signed type and a nonnegative value, the value of
the result is the integral part of the quotient of <TT>E1</TT>
<DEL>divided by the quantity 2 raised to the power <TT>E2</TT></DEL>
<INS>/ 2<SUP><TT>E2</TT></SUP></INS>.  If <TT>E1</TT> has a signed
type and a negative value, the resulting value is
implementation-defined.</P>

</BLOCKQUOTE>

<BR><BR>
</BODY>
</HTML>
